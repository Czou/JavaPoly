<html>
<head>
  <meta charset="utf-8">
  <title>JavaPoly Tests: Java Source Files</title>
  <link href="mocha/mocha.css" rel="stylesheet" />

  <script type="text/javascript" src="lib/javaparser7.js"></script>
  <script type="text/javascript" src="build/javapoly.js"></script>

  <script type="text/x-java-source">
  package com.javapoly.test;
  public class TestCompile1 {
      public static String testIt() {
        return "TestCompile1::testIt()";
      }
  }
  </script>

  <script type="text/x-java-source">
  package com.javapoly.test;
  public class TestCompile2 {
      public static Integer testIt() {
        return 8008;
      }
  }
  </script>

  <script type="text/x-java-source">
  // This class is not public and should not be parsed
  class LocalClass { }

  // Add generic to check parsing
  public class TestProxyCreation<T> {
      public static String testIt() {
        return "Success";
      }
  }
  </script>

  <script type="text/x-java-source">
  package jp.javapoly.sample;

  public class TestProxyCreationForPackage {
      public static String testIt() {
        return "Success";
      }
  }
  </script>

</head>
<body>
  <div id="mocha"></div>

  <script src="expect/umd/expect.min.js"></script>
  <script src="mocha/mocha.js"></script>

  <script type="text/javascript">
    mocha.setup('bdd');
    expect.extend({
      toBeGreaterThanOrEqual(limit) {
        expect.assert(this.actual >= limit, 'expected %s to be greater than or equal to ' + limit, this.actual);
      }
    });

    describe('JavaPoly', function() {
      this.timeout(1000000); // Let jvm to start and do not interrupt promises

      describe('TestCompile1', function() {
        it('static method returns String', function() {
          return Java.type('com.javapoly.test.TestCompile1').then(function(TestCompile1) {
            return TestCompile1.testIt().then(function(result) {
              expect(result).toEqual('TestCompile1::testIt()');
            });
          });
        });
      });

      describe('TestCompile2', function() {
        it('static method returns Integer', function() {
          return Java.type('com.javapoly.test.TestCompile2').then(function(TestCompile2) {
            return TestCompile2.testIt().then(function(result) {
              expect(result).toEqual(8008);
            });
          });
        });
      });

      var isProxySupported = (typeof Proxy !== 'undefined');

      if (isProxySupported) {
        describe('TestProxyCreation', function() {
          it('Tests that custom root Proxy object works', function() {
            return TestProxyCreation.testIt().then(function(result) {
              expect(result).toEqual("Success");
            });
          });
        });

        describe('TestProxyCreationForPackage', function() {
          it('Tests that custom root Proxy object for package works', function() {
            return jp.javapoly.sample.TestProxyCreationForPackage.testIt().then(function(result) {
              expect(result).toEqual("Success");
            });
          });
        });
      }

    });

    mocha.run();
  </script>
</body>
</html>
